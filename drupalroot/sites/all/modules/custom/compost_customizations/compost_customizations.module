<?php

/**
 * @file
 * General customizations to compost website.
 */

/*
 * Implements hook_mail()
 */
function compost_customizations_mail_alter(&$message) {
  // Set the from address to the site's email so emails don't get blocked coming from uncontrolled sources
  $site_from_email = variable_get('site_mail',  $message['from']);
  $message['headers']['Return-Path']=  $message['from'];
  $message['headers']['From'] = $message['headers']['Sender']  = $message['from'] = $site_from_email;
}

/*
 * Implements hook_block_info()
 */
function compost_customizations_block_info() {

  $blocks['paypal_payment_form'] = array(
    'info' => t('Paypal payment form'),
    'cache' => DRUPAL_NO_CACHE,
  );


  return $blocks;
}

/*
 * Implements hook_block_view()
 */
function compost_customizations_block_view($delta = '') {
  // This example is adapted from node.module.
  $block = array();

  switch ($delta) {
    case 'paypal_payment_form':
      $block['subject'] = t('Paypal payment form');
      $block['content'] = array(
        '#theme' => 'paypal_payment_form'
      );
      break;
  }
  return $block;

}

/*
 * Implements hook_theme()
 */
function compost_customizations_theme() {
  return array(
    'paypal_payment_form' => array(
      'template' => "templates/paypal_payment_form"
    ),
  );
}

/*
 * Implements hook_form_FORM_ID_alter()
 */
function compost_customizations_form_user_register_form_alter(&$form, $form_state, $form_id) {
  // Change "Create new account" to "Register"
  $form['actions']['submit']['#value'] = t('Register');

  // Only reveal mobile carrier inquiry if user wants text reminders
  $form['field_mobile_carrier_provider']['#states'] = array(
    'invisible' => array(
      ':input[name="field_reminders[und][2]"]' => array('checked' => FALSE),
    ),
  );

  // @todo: Change form submission to redirect to paypal papyment

}